<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Evergrowth Org Views</title>

  <!-- Favicon -->
  <link rel="icon" href="https://cdn.prod.website-files.com/67de9a786ff9ec4a82a4453a/67f6be889df4d0a86c22e5d1_favicon.svg" type="image/svg+xml">

  <style>
    :root{
      --bg:#0b0c10;
      --panel:#12141b;
      --text:#e8eaf0;
      --muted:#a9afbf;
      --line:#2a2f3d;
      --accent:#6ee7ff;
      --agent:#a855f7;
      --node:#161a22;
      --nodeBorder:#2b3244;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 30% -10%, rgba(110,231,255,.10), transparent 60%),
                  radial-gradient(900px 600px at 90% 0%, rgba(168,85,247,.10), transparent 55%),
                  var(--bg);
      color:var(--text);
    }

    header{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      background: rgba(11,12,16,.65);
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 18px;
    }
    h1{
      font-size: 18px;
      margin: 0 0 10px 0;
      letter-spacing: .2px;
    }
    .sub{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.4;
    }

    .toolbar{
      display:flex;
      gap: 12px;
      align-items:center;
      justify-content: space-between;
      margin-top: 14px;
      flex-wrap: wrap;
    }

    /* Segmented control */
    .seg{
      display: inline-flex;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      padding: 4px;
      gap: 4px;
    }
    .seg button{
      appearance:none;
      border:0;
      background: transparent;
      color: var(--muted);
      padding: 8px 12px;
      border-radius: 999px;
      cursor:pointer;
      font-size: 13px;
      transition: background .15s ease, color .15s ease, transform .05s ease;
      white-space: nowrap;
    }
    .seg button:hover{ color: var(--text); }
    .seg button:active{ transform: translateY(1px); }
    .seg button[aria-pressed="true"]{
      background: rgba(110,231,255,.14);
      color: var(--text);
      box-shadow: inset 0 0 0 1px rgba(110,231,255,.25);
    }

    .legend{
      display:flex;
      gap: 10px;
      align-items:center;
      color: var(--muted);
      font-size: 12px;
      flex-wrap: wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      padding: 6px 10px;
    }
    .dot{
      width: 10px; height: 10px; border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 3px rgba(110,231,255,.12);
    }
    .dot.agent{
      background: var(--agent);
      box-shadow: 0 0 0 3px rgba(168,85,247,.12);
    }

    main .wrap{
      padding-top: 22px;
      padding-bottom: 34px;
    }

    .board{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      overflow: auto;

      /* nicer scrolling behavior for wide charts */
      overscroll-behavior: contain;
      scroll-padding-left: 30px;
      scroll-padding-right: 30px;
    }

    /* Org chart structure */
    .org{
      /* KEY FIX #1: chart becomes as wide as it needs to be, enabling full horizontal scroll */
      width: max-content;
      min-width: 100%;
      padding: 8px 26px 18px;
    }
    .org ul{
      padding-top: 20px;
      position: relative;
      display:flex;
      justify-content: flex-start; /* KEY FIX #1: no centering that can ‚Äústeal‚Äù scroll range */
      align-items: flex-start;
      gap: 22px;
      padding-left: 0;
      margin: 0;
      list-style: none;
      width: max-content; /* ensures true content width is used for scrolling */
    }
    .org li{
      text-align:center;
      position: relative;
      padding: 20px 10px 0 10px;
      flex: 0 0 auto;
    }

    /* Connector lines (horizontal sibling layout) */
    .org li::before,
    .org li::after{
      content:"";
      position:absolute;
      top:0;
      right:50%;
      border-top: 1px solid var(--line);
      width:50%;
      height: 20px;
    }
    .org li::after{
      right:auto;
      left:50%;
      border-left: 1px solid var(--line);
      width:50%;
    }
    .org li:only-child::after,
    .org li:only-child::before{
      display:none;
    }
    .org li:only-child{
      padding-top: 0;
    }
    .org li:first-child::before,
    .org li:last-child::after{
      border:0 none;
    }
    .org li:last-child::before{
      border-right: 1px solid var(--line);
      border-radius: 0 10px 0 0;
    }
    .org li:first-child::after{
      border-radius: 10px 0 0 0;
    }

    .org ul ul::before{
      content:"";
      position:absolute;
      top:0;
      left:50%;
      border-left: 1px solid var(--line);
      width:0;
      height: 20px;
    }

    /* KEY FIX #2: vertical stacking mode for children */
    .org ul.stack-vertical{
      flex-direction: column;
      align-items: center;
      gap: 14px;
      width: max-content;
    }
    .org ul.stack-vertical > li{
      padding-top: 20px;
    }
    /* remove horizontal sibling connectors */
    .org ul.stack-vertical > li::after{
      display:none !important;
    }
    .org ul.stack-vertical > li::before{
      content:"";
      position:absolute;
      top:0;
      left:50%;
      width:0;
      height: 20px;
      border-left: 1px solid var(--line);
      transform: translateX(-50%);
    }
    .org ul.stack-vertical > li:first-child::before,
    .org ul.stack-vertical > li:last-child::before{
      border-radius: 0;
      border-right: 0;
    }

    /* Node card */
    .node{
      display:flex;
      flex-direction: column;
      gap: 10px;
      min-width: 210px;
      max-width: 270px;
      padding: 12px 12px;
      background: rgba(22,26,34,.9);
      border: 1px solid rgba(255,255,255,.10);
      border-color: var(--nodeBorder);
      border-radius: 14px;
      box-shadow: 0 8px 18px rgba(0,0,0,.22);
      cursor: default;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease;
    }
    .node:hover{
      transform: translateY(-2px);
      border-color: rgba(110,231,255,.45);
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
    }
    .node.agent:hover{
      border-color: rgba(168,85,247,.55);
    }

    /* Group node styling (for ‚ÄúEngineering‚Äù bucket) */
    .node.group{
      background: rgba(18,20,27,.65);
      border-style: dashed;
      cursor: default;
    }
    .node.group:hover{
      transform: none;
      border-color: rgba(255,255,255,.16);
      box-shadow: 0 8px 18px rgba(0,0,0,.22);
    }

    .row{
      display:flex;
      gap: 10px;
      align-items: center;
      justify-content: flex-start;
      text-align: left;
    }

    /* KEY FIX #4: avatar placeholder circle */
    .avatar{
      width: 44px;
      height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: radial-gradient(12px 12px at 30% 25%, rgba(255,255,255,.12), transparent 60%),
                  rgba(255,255,255,.05);
      overflow: hidden;
      flex: 0 0 auto;
      display:grid;
      place-items:center;
      user-select:none;
    }
    .avatar img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }
    .avatar .ph{
      font-weight: 700;
      font-size: 12px;
      letter-spacing: .3px;
      color: rgba(255,255,255,.85);
    }
    .avatar.agent{
      background: radial-gradient(12px 12px at 30% 25%, rgba(168,85,247,.18), transparent 60%),
                  rgba(168,85,247,.10);
      border-color: rgba(168,85,247,.25);
    }

    .text{
      display:flex;
      flex-direction: column;
      gap: 6px;
      min-width: 0;
    }

    /* KEY FIX #3: department pill */
    .dept-pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      width: fit-content;
      max-width: 100%;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: .2px;
      color: rgba(255,255,255,.85);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .name{
      font-weight: 650;
      font-size: 13px;
      letter-spacing: .2px;
      line-height: 1.15;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .title{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .meta{
      display:flex;
      gap: 10px;
      justify-content: flex-start;
      align-items:center;
      color: rgba(255,255,255,.75);
      font-size: 11px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap: 6px;
      border-radius: 999px;
      padding: 4px 9px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
    }
    .badge .mini{
      width: 7px; height: 7px; border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 0 2px rgba(110,231,255,.12);
    }
    .badge.agent .mini{
      background: var(--agent);
      box-shadow: 0 0 0 2px rgba(168,85,247,.12);
    }
    .badge.group .mini{
      background: rgba(255,255,255,.45);
      box-shadow: 0 0 0 2px rgba(255,255,255,.10);
    }

    /* Tooltip */
    .tooltip{
      position: fixed;
      z-index: 1000;
      pointer-events: none;
      max-width: 340px;
      background: rgba(18,20,27,.95);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      box-shadow: 0 16px 40px rgba(0,0,0,.45);
      padding: 12px 12px;
      transform: translate(12px, 12px);
      opacity: 0;
      transition: opacity .12s ease;
    }
    .tooltip.show{ opacity: 1; }
    .tooltip h3{
      margin:0 0 6px 0;
      font-size: 13px;
      letter-spacing: .2px;
    }
    .tooltip .tt-title{
      margin:0 0 8px 0;
      color: var(--muted);
      font-size: 12px;
    }
    .tooltip .tt-label{
      color: rgba(255,255,255,.85);
      font-size: 11px;
      letter-spacing: .18px;
      text-transform: uppercase;
      margin: 10px 0 4px 0;
    }
    .tooltip .tt-body{
      margin:0;
      color: rgba(255,255,255,.85);
      font-size: 12px;
      line-height: 1.45;
      white-space: pre-line;
    }

    @media (max-width: 900px){
      .board{ padding: 14px; }
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <h1>Evergrowth Org Views</h1>
    <p class="sub">Three switchable org charts. Hover any node to see responsibilities + bio. Edit the <code>DATA</code> section in the script to match your real people/agents.</p>

    <div class="toolbar">
      <div class="seg" role="group" aria-label="Org chart view toggle">
        <button id="btn-humans" aria-pressed="true">1 ‚Äî Humans only</button>
        <button id="btn-agents" aria-pressed="false">2 ‚Äî Agents only</button>
        <button id="btn-combined" aria-pressed="false">3 ‚Äî Combined</button>
      </div>

      <div class="legend" aria-label="Legend">
        <span class="pill"><span class="dot"></span> Human</span>
        <span class="pill"><span class="dot agent"></span> Agent</span>
        <span class="pill">Tip: Hover nodes</span>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="wrap">
    <div class="board" id="board">
      <div id="orgRoot" class="org" aria-live="polite"></div>
    </div>
  </div>
</main>

<div id="tooltip" class="tooltip" role="tooltip" aria-hidden="true"></div>

<script>
/**
 * ==========================
 * DATA ‚Äî EDIT THIS SECTION
 * ==========================
 * Each node:
 * {
 *   id: "unique",
 *   kind: "human" | "agent" | "group",
 *   name: "Display Name",
 *   title: "Role/Title",
 *   department?: "Department Name",  // shows as a pill (children inherit)
 *   avatarUrl?: "https://....png",   // optional; otherwise placeholder circle
 *   responsibilities: "...",
 *   bio: "...",
 *   stackChildren?: true,            // makes that node's children render vertically
 *   children: [ ...nodes ]
 * }
 */

const HUMANS_ONLY = {
  id: "ceo",
  kind: "human",
  name: "JB Daguen√©",
  title: "CEO",
  department: "Executive",
  responsibilities: "Company strategy, exec decisions, prioritization, hiring.",
  bio: "Founder/CEO. Owns vision and overall execution.",
  children: [
    {
      id: "prodeng",
      kind: "human",
      name: "Nauris Dorbe",
      title: "CTO",
      department: "Product & Engineering",
      responsibilities: "Engineering leadership, technical strategy, architecture.",
      bio: "Leads Product & Engineering delivery and technical direction.",
      children: [
        {
          id: "monika",
          kind: "human",
          name: "Monika Staponkutƒó",
          title: "Head of Product",
          responsibilities: "Product strategy, roadmap, discovery, requirements.",
          bio: "Owns the product direction and cross-functional alignment."
        },
        {
          id: "chirag",
          kind: "human",
          name: "Chirag Patel",
          title: "UX Design Lead",
          responsibilities: "Design systems, user research, interaction design.",
          bio: "Leads product design and user experience."
        },

        /* KEY FIX #2: Developers are grouped and stacked vertically */
        {
          id: "eng-group",
          kind: "group",
          name: "Engineering",
          title: "Developers",
          responsibilities: "Development team members reporting into Product & Engineering.",
          bio: "Grouped + stacked vertically to keep the org readable.",
          stackChildren: true,
          children: [
            {
              id: "donatas",
              kind: "human",
              name: "Donatas Ma≈°lƒóktƒónas",
              title: "Front-end Engineer",
              responsibilities: "UI implementation, performance, component systems.",
              bio: "Builds user-facing features and improves UX quality."
            },
            {
              id: "marks",
              kind: "human",
              name: "Marks Leidemans",
              title: "Senior Software Engineer",
              responsibilities: "Backend systems, reliability, core services.",
              bio: "Builds and maintains key platform capabilities."
            },
            {
              id: "cosmin",
              kind: "human",
              name: "Cosmin Romeo Tanase",
              title: "Full-stack Engineer",
              responsibilities: "End-to-end feature delivery across stack.",
              bio: "Ships features across frontend + backend."
            },
            {
              id: "edvinas",
              kind: "human",
              name: "Edvinas Rabikis",
              title: "Full Stack Engineer",
              responsibilities: "Product features, integrations, platform improvements.",
              bio: "Delivers full-stack work across the product."
            }
          ]
        }
      ]
    },
    {
      id: "ops",
      kind: "human",
      name: "Beatrise Pociute-Daguen√©",
      title: "Head of Business Operations",
      department: "Operations",
      responsibilities: "Company ops, finance ops, systems/processes.",
      bio: "Keeps the business running smoothly.",
      children: [
        {
          id: "ruta",
          kind: "human",
          name: "R≈´ta Dorofejevaitƒó",
          title: "Senior Accountant",
          responsibilities: "Accounting operations, close, reporting, compliance.",
          bio: "Owns day-to-day accounting and financial hygiene."
        }
      ]
    },
    {
      id: "cs",
      kind: "human",
      name: "Diana Heisler",
      title: "Head of CS",
      department: "Customer Success",
      responsibilities: "Customer onboarding, renewals, support, outcomes.",
      bio: "Owns customer success and retention motions.",
      children: [
        {
          id: "matt",
          kind: "human",
          name: "Matt Gencer",
          title: "Solutions Engineer",
          responsibilities: "Technical onboarding, implementations, support escalation.",
          bio: "Bridges product + customer technical needs."
        },
        {
          id: "suleman",
          kind: "human",
          name: "Suleman Mahmud",
          title: "GTM Ops",
          responsibilities: "Rev ops support, systems, reporting, process.",
          bio: "Keeps GTM operations tight and measurable."
        }
      ]
    },
    {
      id: "sales",
      kind: "human",
      name: "Cody Ayres",
      title: "Head of GTM",
      department: "Sales",
      responsibilities: "GTM strategy, pipeline, sales execution.",
      bio: "Owns revenue outcomes and GTM performance.",
      children: [
        {
          id: "justin",
          kind: "human",
          name: "Justin Rodzviello",
          title: "Head of RevOps and Client Consulting",
          responsibilities: "RevOps strategy, client consulting delivery, enablement.",
          bio: "Owns RevOps + consulting engagements.",
          children: [
            {
              id: "rudolfs",
              kind: "human",
              name: "Rudolfs Selga",
              title: "GTM Ops",
              responsibilities: "Ops support, tooling, data hygiene, process.",
              bio: "Supports GTM systems and execution."
            }
          ]
        },
        {
          id: "magnus",
          kind: "human",
          name: "Magnus Thomsen",
          title: "Senior AE",
          responsibilities: "Pipeline creation, deal execution, customer development.",
          bio: "Drives new business and expansions."
        }
      ]
    },
    {
      id: "mktg",
      kind: "human",
      name: "James Ince",
      title: "Head of Product Marketing",
      department: "Marketing",
      responsibilities: "Messaging, positioning, launches, enablement, competitive.",
      bio: "Owns product marketing strategy and execution."
    }
  ]
};

const AGENTS_ONLY = {
  id: "agent-ceo",
  kind: "agent",
  name: "Exec Ops Agent",
  title: "Company Orchestrator",
  department: "Executive",
  responsibilities: "Summarizes key metrics, surfaces risks, drafts exec updates.",
  bio: "Supports leadership cadence and decision-making.",
  children: [
    {
      id: "agent-prodeng",
      kind: "agent",
      name: "Eng Manager Agent",
      title: "Product & Engineering",
      department: "Product & Engineering",
      responsibilities: "Ticket triage, PR summaries, release notes, QA checklists.",
      bio: "Keeps engineering throughput high with low friction.",
      children: [
        { id: "agent-pm", kind: "agent", name: "Product Insights Agent", title: "Discovery / Roadmap", responsibilities: "Synthesizes feedback, drafts PRDs, identifies themes.", bio: "Turns input into actionable product direction." },
        { id: "agent-ux", kind: "agent", name: "UX Research Agent", title: "Design Support", responsibilities: "Interview summaries, persona drafts, usability test analysis.", bio: "Accelerates customer understanding." },
        { id: "agent-be", kind: "agent", name: "Reliability Agent", title: "Backend Support", responsibilities: "Monitors logs, proposes alerts, drafts incident postmortems.", bio: "Supports stability and reliability." }
      ]
    },
    {
      id: "agent-ops",
      kind: "agent",
      name: "BizOps Agent",
      title: "Operations",
      department: "Operations",
      responsibilities: "Policy drafts, SOP updates, vendor comparisons, finance reminders.",
      bio: "Makes ops work repeatable and documented.",
      children: [
        { id: "agent-acct", kind: "agent", name: "Close Checklist Agent", title: "Accounting Support", responsibilities: "Monthly close checklist, anomaly detection, categorization drafts.", bio: "Reduces finance busywork." }
      ]
    },
    {
      id: "agent-cs",
      kind: "agent",
      name: "CS Lead Agent",
      title: "Customer Success",
      department: "Customer Success",
      responsibilities: "Call summaries, action items, success plans, risk flags.",
      bio: "Improves retention by operationalizing outcomes.",
      children: [
        { id: "agent-sol", kind: "agent", name: "Implementation Agent", title: "Solutions Support", responsibilities: "Integration checklists, setup guides, troubleshooting steps.", bio: "Speeds time-to-value." },
        { id: "agent-gtmops1", kind: "agent", name: "CS Ops Agent", title: "Ops Support", responsibilities: "Health scoring drafts, dashboards, renewal reminders.", bio: "Makes CS measurable." }
      ]
    },
    {
      id: "agent-sales",
      kind: "agent",
      name: "GTM Strategy Agent",
      title: "Sales",
      department: "Sales",
      responsibilities: "Account research, email drafts, call prep, pipeline summaries.",
      bio: "Increases seller output per hour.",
      children: [
        { id: "agent-revops", kind: "agent", name: "RevOps Agent", title: "RevOps / Consulting Support", responsibilities: "CRM hygiene prompts, reporting drafts, enablement snippets.", bio: "Keeps data clean and playbooks current." },
        { id: "agent-ae", kind: "agent", name: "Deal Desk Agent", title: "AE Support", responsibilities: "Objection handling docs, mutual action plans, next-step emails.", bio: "Helps deals move forward." }
      ]
    },
    {
      id: "agent-mktg",
      kind: "agent",
      name: "PMM Agent",
      title: "Marketing",
      department: "Marketing",
      responsibilities: "Positioning drafts, competitive briefs, launch checklists, enablement.",
      bio: "Accelerates messaging and launch execution."
    }
  ]
};

const COMBINED = deepClone(HUMANS_ONLY);
injectAgents(COMBINED);

/** ==========================
 * RENDERING
 * ========================== */
const orgRoot = document.getElementById("orgRoot");
const tooltip = document.getElementById("tooltip");

const btnHumans = document.getElementById("btn-humans");
const btnAgents = document.getElementById("btn-agents");
const btnCombined = document.getElementById("btn-combined");

const VIEWS = { humans: HUMANS_ONLY, agents: AGENTS_ONLY, combined: COMBINED };

let currentView = "humans";
render(VIEWS[currentView]);

btnHumans.addEventListener("click", () => setView("humans"));
btnAgents.addEventListener("click", () => setView("agents"));
btnCombined.addEventListener("click", () => setView("combined"));

function setView(view){
  currentView = view;
  btnHumans.setAttribute("aria-pressed", view === "humans");
  btnAgents.setAttribute("aria-pressed", view === "agents");
  btnCombined.setAttribute("aria-pressed", view === "combined");
  render(VIEWS[view]);
}

function render(tree){
  orgRoot.innerHTML = "";
  const ul = document.createElement("ul");
  ul.appendChild(renderNode(tree, tree.department || ""));
  orgRoot.appendChild(ul);
  bindTooltips();
}

function renderNode(node, inheritedDept){
  const kind = node.kind || "human";
  const dept = node.department || inheritedDept || "";

  const li = document.createElement("li");

  const card = document.createElement("div");
  card.className = "node" + (kind === "agent" ? " agent" : "") + (kind === "group" ? " group" : "");

  // tooltip data
  card.dataset.name = node.name || "";
  card.dataset.title = node.title || "";
  card.dataset.department = dept || "";
  card.dataset.responsibilities = node.responsibilities || "";
  card.dataset.bio = node.bio || "";

  // Top row: avatar + text
  const row = document.createElement("div");
  row.className = "row";

  if (kind !== "group"){
    const avatar = document.createElement("div");
    avatar.className = "avatar" + (kind === "agent" ? " agent" : "");
    if (node.avatarUrl){
      const img = document.createElement("img");
      img.src = node.avatarUrl;
      img.alt = `${node.name || "Avatar"}`;
      img.loading = "lazy";
      avatar.appendChild(img);
    } else {
      const ph = document.createElement("div");
      ph.className = "ph";
      ph.textContent = kind === "agent" ? "ü§ñ" : initials(node.name || "");
      avatar.appendChild(ph);
    }
    row.appendChild(avatar);
  }

  const text = document.createElement("div");
  text.className = "text";

  if (dept){
    const deptPill = document.createElement("div");
    deptPill.className = "dept-pill";
    deptPill.textContent = dept;
    text.appendChild(deptPill);
  }

  const name = document.createElement("div");
  name.className = "name";
  name.textContent = node.name || "(Unnamed)";
  text.appendChild(name);

  if (node.title){
    const title = document.createElement("div");
    title.className = "title";
    title.textContent = node.title || "";
    text.appendChild(title);
  }

  row.appendChild(text);
  card.appendChild(row);

  // Meta badges
  const meta = document.createElement("div");
  meta.className = "meta";

  const badge = document.createElement("span");
  badge.className = "badge" + (kind === "agent" ? " agent" : "") + (kind === "group" ? " group" : "");

  const mini = document.createElement("span");
  mini.className = "mini";

  const label = document.createElement("span");
  label.textContent = kind === "agent" ? "Agent" : (kind === "group" ? "Group" : "Human");

  badge.appendChild(mini);
  badge.appendChild(label);
  meta.appendChild(badge);

  card.appendChild(meta);
  li.appendChild(card);

  if (node.children && node.children.length){
    const childUL = document.createElement("ul");
    if (node.stackChildren) childUL.classList.add("stack-vertical");
    for (const child of node.children){
      childUL.appendChild(renderNode(child, dept));
    }
    li.appendChild(childUL);
  }

  return li;
}

function bindTooltips(){
  const nodes = orgRoot.querySelectorAll(".node");
  nodes.forEach(n => {
    n.addEventListener("mouseenter", (e) => showTooltip(e.currentTarget, e));
    n.addEventListener("mousemove", (e) => moveTooltip(e));
    n.addEventListener("mouseleave", hideTooltip);
  });
}

function showTooltip(el, e){
  const name = el.dataset.name || "";
  const title = el.dataset.title || "";
  const dept = el.dataset.department || "";
  const responsibilities = el.dataset.responsibilities || "";
  const bio = el.dataset.bio || "";

  if (!responsibilities && !bio && !dept) return;

  tooltip.innerHTML = `
    <h3>${escapeHtml(name)}</h3>
    ${title ? `<div class="tt-title">${escapeHtml(title)}</div>` : ""}
    ${dept ? `<div class="tt-label">Department</div><p class="tt-body">${escapeHtml(dept)}</p>` : ""}
    ${responsibilities ? `<div class="tt-label">Responsibilities</div><p class="tt-body">${escapeHtml(responsibilities)}</p>` : ""}
    ${bio ? `<div class="tt-label">Bio</div><p class="tt-body">${escapeHtml(bio)}</p>` : ""}
  `;

  tooltip.classList.add("show");
  tooltip.setAttribute("aria-hidden", "false");
  moveTooltip(e);
}

function moveTooltip(e){
  const pad = 14;
  const ttRect = tooltip.getBoundingClientRect();
  let x = e.clientX + 14;
  let y = e.clientY + 14;

  if (x + ttRect.width + pad > window.innerWidth) x = e.clientX - ttRect.width - 14;
  if (y + ttRect.height + pad > window.innerHeight) y = e.clientY - ttRect.height - 14;

  tooltip.style.left = x + "px";
  tooltip.style.top = y + "px";
}

function hideTooltip(){
  tooltip.classList.remove("show");
  tooltip.setAttribute("aria-hidden", "true");
}

/** ==========================
 * COMBINED VIEW HELPERS
 * ========================== */
function injectAgents(tree){
  if (!tree || !tree.children) return;

  for (const deptLead of tree.children){
    const agentsForDept = agentsForDepartment(deptLead.id);
    if (!agentsForDept.length) continue;

    const groupNode = {
      id: deptLead.id + "-agents-group",
      kind: "group",
      name: "Agents",
      title: "Trained / Owned Agents",
      responsibilities: "Operational support agents aligned to this function.",
      bio: "Grouped to keep the chart readable.",
      stackChildren: true,
      children: agentsForDept
    };

    deptLead.children = deptLead.children || [];
    deptLead.children.push(groupNode);
  }
}

function agentsForDepartment(deptLeadId){
  const map = {
    prodeng: [
      { id:"c-agent-1", kind:"agent", name:"Release Notes Agent", title:"Engineering Support", responsibilities:"Drafts release notes, changelog entries, PR summaries.", bio:"Speeds up shipping comms." },
      { id:"c-agent-2", kind:"agent", name:"QA Checklist Agent", title:"Quality Support", responsibilities:"Generates test checklists and edge-case prompts.", bio:"Reduces regressions." }
    ],
    ops: [
      { id:"c-agent-3", kind:"agent", name:"SOP Agent", title:"Ops Support", responsibilities:"Drafts SOPs, policy templates, process docs.", bio:"Keeps ops scalable." }
    ],
    cs: [
      { id:"c-agent-4", kind:"agent", name:"Call Summary Agent", title:"CS Support", responsibilities:"Summarizes calls, creates action items, flags risks.", bio:"Improves follow-through." }
    ],
    sales: [
      { id:"c-agent-5", kind:"agent", name:"Account Research Agent", title:"Sales Support", responsibilities:"Account briefs, trigger events, stakeholder mapping.", bio:"Improves meeting prep." },
      { id:"c-agent-6", kind:"agent", name:"Outbound Copy Agent", title:"Sales Support", responsibilities:"Personalized email drafts by persona and ICP.", bio:"Increases outbound velocity." }
    ],
    mktg: [
      { id:"c-agent-7", kind:"agent", name:"Competitive Intel Agent", title:"PMM Support", responsibilities:"Tracks competitors, drafts battlecards, highlights changes.", bio:"Keeps enablement current." },
      { id:"c-agent-8", kind:"agent", name:"Launch Copy Agent", title:"PMM Support", responsibilities:"Drafts launch messaging, web copy variants, FAQs.", bio:"Speeds launches." }
    ]
  };
  return (map[deptLeadId] || []).map(a => ({ ...a, kind: "agent" }));
}

/** ==========================
 * UTIL
 * ========================== */
function deepClone(obj){
  return JSON.parse(JSON.stringify(obj));
}
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"quot;")
    .replaceAll("'","&#039;");
}
function initials(name){
  const parts = name.trim().split(/\s+/).filter(Boolean);
  if (!parts.length) return "‚Ä¢";
  const first = parts[0][0] || "";
  const last = parts.length > 1 ? (parts[parts.length-1][0] || "") : "";
  return (first + last).toUpperCase();
}
</script>
</body>
</html>
