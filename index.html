<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Evergrowth Org Chart</title>

    <link
      rel="icon"
      href="https://cdn.prod.website-files.com/67de9a786ff9ec4a82a4453a/67f6be889df4d0a86c22e5d1_favicon.svg"
      type="image/svg+xml"
    />

    <style>
      :root {
        /* Layout */
        --radius: 14px;
        --deptGap: 130px;
        --nodeGap: 34px;
        --levelGap: 52px;

        /* Wires */
        --wireRadius: 44;
        --wireDash: 6 6;

        /* Accents */
        --accent: #2dd4ff;
        --agent: #a855f7;

        /* Light theme (default) */
        --bg: #fefefe;
        --text: #0f172a;
        --muted: #475569;

        --headerBg: rgba(254, 254, 254, 0.82);
        --headerBorder: rgba(15, 23, 42, 0.10);

        --panelBg1: rgba(15, 23, 42, 0.03);
        --panelBg2: rgba(15, 23, 42, 0.015);
        --panelBorder: rgba(15, 23, 42, 0.10);
        --shadow: 0 12px 30px rgba(15, 23, 42, 0.08);

        --uiBg: rgba(15, 23, 42, 0.05);
        --uiBorder: rgba(15, 23, 42, 0.12);

        --cardBg: rgba(255, 255, 255, 0.96);
        --cardBorder: rgba(15, 23, 42, 0.14);

        --deptPillBg: rgba(15, 23, 42, 0.06);
        --deptPillBorder: rgba(15, 23, 42, 0.14);

        --tooltipBg: rgba(255, 255, 255, 0.98);
        --tooltipBorder: rgba(15, 23, 42, 0.14);
        --tooltipShadow: 0 16px 40px rgba(15, 23, 42, 0.18);

        --wire: rgba(15, 23, 42, 0.28);

        /* Make the white logo visible in light mode */
        --logoFilter: invert(1) saturate(0) contrast(1.1);
      }

      html[data-theme="dark"] {
        --bg: #0b0c10;
        --text: #e8eaf0;
        --muted: #a9afbf;

        --headerBg: rgba(11, 12, 16, 0.65);
        --headerBorder: rgba(255, 255, 255, 0.06);

        --panelBg1: rgba(255, 255, 255, 0.05);
        --panelBg2: rgba(255, 255, 255, 0.02);
        --panelBorder: rgba(255, 255, 255, 0.08);
        --shadow: 0 12px 30px rgba(0, 0, 0, 0.35);

        --uiBg: rgba(255, 255, 255, 0.06);
        --uiBorder: rgba(255, 255, 255, 0.10);

        --cardBg: rgba(20, 24, 36, 0.96);
        --cardBorder: #2b3244;

        --deptPillBg: rgba(255, 255, 255, 0.08);
        --deptPillBorder: rgba(255, 255, 255, 0.14);

        --tooltipBg: rgba(18, 20, 27, 0.95);
        --tooltipBorder: rgba(255, 255, 255, 0.10);
        --tooltipShadow: 0 16px 40px rgba(0, 0, 0, 0.45);

        --wire: rgba(170, 180, 200, 0.38);

        --logoFilter: none;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
          "Apple Color Emoji", "Segoe UI Emoji";
        background:
          radial-gradient(1200px 800px at 30% -10%, rgba(110, 231, 255, 0.10), transparent 60%),
          radial-gradient(900px 600px at 90% 0%, rgba(168, 85, 247, 0.10), transparent 55%),
          var(--bg);
        color: var(--text);
      }

      header {
        position: sticky;
        top: 0;
        z-index: 10;
        backdrop-filter: blur(10px);
        background: var(--headerBg);
        border-bottom: 1px solid var(--headerBorder);
      }

      .wrap {
        max-width: 1200px;
        margin: 0 auto;
        padding: 18px 18px;
      }

      .topbar {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 12px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        min-width: 0;
      }

      .brand img {
        height: 22px;
        width: auto;
        display: block;
        filter: var(--logoFilter);
      }

      h1 {
        font-size: 18px;
        margin: 0;
        letter-spacing: 0.2px;
        white-space: nowrap;
      }

      .toolbar {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
        margin-top: 14px;
        flex-wrap: wrap;
      }

      .seg {
        display: inline-flex;
        background: var(--uiBg);
        border: 1px solid var(--uiBorder);
        border-radius: 999px;
        padding: 4px;
        gap: 4px;
      }

      .seg button {
        appearance: none;
        border: 0;
        background: transparent;
        color: var(--muted);
        padding: 8px 12px;
        border-radius: 999px;
        cursor: pointer;
        font-size: 13px;
        transition: background 0.15s ease, color 0.15s ease, transform 0.05s ease;
        white-space: nowrap;
      }

      .seg button:hover {
        color: var(--text);
      }
      .seg button:active {
        transform: translateY(1px);
      }

      .seg button[aria-pressed="true"] {
        background: rgba(110, 231, 255, 0.18);
        color: var(--text);
        box-shadow: inset 0 0 0 1px rgba(110, 231, 255, 0.28);
      }

      .legend {
        display: flex;
        gap: 10px;
        align-items: center;
        color: var(--muted);
        font-size: 12px;
        flex-wrap: wrap;
      }

      .pill,
      .theme-toggle {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: var(--uiBg);
        border: 1px solid var(--uiBorder);
        border-radius: 999px;
        padding: 6px 10px;
        color: var(--muted);
      }

      .theme-toggle {
        cursor: pointer;
        user-select: none;
        transition: transform 0.05s ease, background 0.15s ease, color 0.15s ease;
      }

      .theme-toggle:hover {
        color: var(--text);
      }
      .theme-toggle:active {
        transform: translateY(1px);
      }

      .dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: var(--accent);
        box-shadow: 0 0 0 3px rgba(110, 231, 255, 0.12);
      }

      .dot.agent {
        background: var(--agent);
        box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.12);
      }

      main .wrap {
        padding-top: 22px;
        padding-bottom: 34px;
      }

      .board {
        background: linear-gradient(180deg, var(--panelBg1), var(--panelBg2));
        border: 1px solid var(--panelBorder);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 18px;
        overflow: auto;
        overscroll-behavior: contain;
      }

      .chart {
        position: relative;
        width: max-content;
        min-width: 100%;
        padding: 18px 22px 28px;
      }

      .wires {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
      }

      .wires path {
        fill: none;
        stroke: var(--wire);
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
        stroke-dasharray: var(--wireDash);
      }

      .dept-pill,
      .node {
        position: relative;
        z-index: 2;
      }

      .level-0 {
        display: flex;
        justify-content: center;
        margin-bottom: var(--levelGap);
      }

      .departments {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: var(--deptGap);
        width: 100%;
        min-width: 1100px;
      }

      .dept {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 18px;
        min-width: 320px;
        flex: 0 0 auto;
      }

      .dept[data-dept="dept-cs"] {
        min-width: 440px;
      }
      .dept[data-dept="dept-sales"] {
        min-width: 480px;
      }

      .dept-pill {
        padding: 9px 14px;
        border-radius: 999px;
        font-size: 12px;
        color: var(--text);
        background: var(--deptPillBg);
        border: 1px solid var(--deptPillBorder);
        margin-top: 10px;
        backdrop-filter: blur(6px);

        max-width: 280px;
        text-align: center;
        line-height: 1.2;

        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
        word-break: break-word;
      }

      .node-wrap {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
      }

      .children {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        gap: var(--nodeGap);
      }

      .children.column {
        flex-direction: column;
        gap: 18px;
      }

      .node {
        width: 240px;
        background: var(--cardBg);
        border: 1px solid var(--cardBorder);
        border-radius: 14px;
        box-shadow: 0 8px 18px rgba(15, 23, 42, 0.10);
        padding: 12px 12px;
        transition: transform 0.12s ease, border-color 0.12s ease, box-shadow 0.12s ease;
        cursor: default;
        backdrop-filter: blur(8px);
      }

      html[data-theme="dark"] .node {
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.22);
      }

      .node:hover {
        transform: translateY(-2px);
        border-color: rgba(110, 231, 255, 0.45);
        box-shadow: 0 12px 26px rgba(15, 23, 42, 0.14);
      }

      html[data-theme="dark"] .node:hover {
        box-shadow: 0 12px 26px rgba(0, 0, 0, 0.35);
      }

      .node.agent:hover {
        border-color: rgba(168, 85, 247, 0.55);
      }

      .node.label {
        width: auto;
        max-width: 280px;
        padding: 7px 12px;
        border-radius: 999px;
        background: var(--uiBg);
        border: 1px dashed var(--uiBorder);
        box-shadow: none;
        text-align: center;

        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
        word-break: break-word;
      }

      .row {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .avatar {
        width: 44px;
        height: 44px;
        border-radius: 999px;
        border: 1px solid rgba(15, 23, 42, 0.14);
        background: radial-gradient(
            12px 12px at 30% 25%,
            rgba(15, 23, 42, 0.06),
            transparent 60%
          ),
          rgba(15, 23, 42, 0.03);
        overflow: hidden;
        display: grid;
        place-items: center;
        flex: 0 0 auto;
        user-select: none;
      }

      html[data-theme="dark"] .avatar {
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: radial-gradient(
            12px 12px at 30% 25%,
            rgba(255, 255, 255, 0.12),
            transparent 60%
          ),
          rgba(255, 255, 255, 0.05);
      }

      .avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .avatar .ph {
        font-weight: 700;
        font-size: 12px;
        letter-spacing: 0.3px;
        color: var(--text);
      }

      .avatar.agent {
        border-color: rgba(168, 85, 247, 0.25);
        background: radial-gradient(
            12px 12px at 30% 25%,
            rgba(168, 85, 247, 0.18),
            transparent 60%
          ),
          rgba(168, 85, 247, 0.10);
      }

      .text {
        min-width: 0;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .name {
        font-weight: 650;
        font-size: 13px;
        letter-spacing: 0.2px;
        line-height: 1.15;

        white-space: normal;
        overflow: hidden;
        word-break: break-word;

        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
      }

      .title {
        color: var(--muted);
        font-size: 12px;
        line-height: 1.2;

        white-space: normal;
        overflow: hidden;
        word-break: break-word;

        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
      }

      .meta {
        margin-top: 10px;
        display: flex;
        justify-content: flex-start;
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        border-radius: 999px;
        padding: 4px 9px;
        border: 1px solid var(--uiBorder);
        background: var(--uiBg);
        font-size: 11px;
        color: var(--muted);
      }

      .badge .mini {
        width: 7px;
        height: 7px;
        border-radius: 999px;
        background: var(--accent);
        box-shadow: 0 0 0 2px rgba(110, 231, 255, 0.12);
      }

      .badge.agent .mini {
        background: var(--agent);
        box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.12);
      }

      .tooltip {
        position: fixed;
        z-index: 1000;
        pointer-events: none;
        max-width: 360px;
        background: var(--tooltipBg);
        border: 1px solid var(--tooltipBorder);
        border-radius: 14px;
        box-shadow: var(--tooltipShadow);
        padding: 12px 12px;
        transform: translate(12px, 12px);
        opacity: 0;
        transition: opacity 0.12s ease;
        color: var(--text);
      }

      .tooltip.show {
        opacity: 1;
      }

      .tooltip h3 {
        margin: 0 0 6px 0;
        font-size: 13px;
        letter-spacing: 0.2px;
      }

      .tooltip .tt-title {
        margin: 0 0 8px 0;
        color: var(--muted);
        font-size: 12px;
      }

      .tooltip .tt-label {
        color: var(--muted);
        font-size: 11px;
        letter-spacing: 0.18px;
        text-transform: uppercase;
        margin: 10px 0 4px 0;
      }

      .tooltip .tt-body {
        margin: 0;
        color: var(--text);
        font-size: 12px;
        line-height: 1.45;
        white-space: pre-line;
      }
    </style>
  </head>

  <body>
    <header>
      <div class="wrap">
        <div class="topbar">
          <div class="brand">
            <img
              src="https://cdn.prod.website-files.com/67de9a786ff9ec4a82a4453a/68c4096ff34c77991c90b139_EvergrowthLogoWhite.png"
              alt="Evergrowth logo"
            />
            <h1>Evergrowth Org Chart</h1>
          </div>
        </div>

        <div class="toolbar">
          <div class="seg" role="group" aria-label="Org chart view toggle">
            <button id="btn-humans" aria-pressed="true"></button>
            <button id="btn-agents" aria-pressed="false"></button>
            <button id="btn-combined" aria-pressed="false"></button>
          </div>

          <div class="legend" aria-label="Legend">
            <span class="pill"><span class="dot"></span> Human</span>
            <span class="pill"><span class="dot agent"></span> Agent</span>
            <span class="pill">Tip: Hover nodes</span>
            <button id="themeToggle" class="theme-toggle" type="button" aria-pressed="false">
              Dark mode
            </button>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="wrap">
        <div class="board" id="board">
          <div class="chart" id="chart">
            <svg class="wires" id="wires"></svg>
            <div class="level-0" id="ceoMount"></div>
            <div class="departments" id="deptMount"></div>
          </div>
        </div>
      </div>
    </main>

    <div id="tooltip" class="tooltip" role="tooltip" aria-hidden="true"></div>

    <script>
      // ==========================
      // Helpers
      // ==========================

      function deepClone(obj) {
        return JSON.parse(JSON.stringify(obj));
      }

      function escapeHtml(str) {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function initials(name) {
        const parts = name.trim().split(/\s+/).filter(Boolean);
        if (!parts.length) return "â€¢";
        const first = parts[0][0] || "";
        const last = parts.length > 1 ? parts[parts.length - 1][0] || "" : "";
        return (first + last).toUpperCase();
      }

      function toRawGitHub(url) {
        if (!url) return url;
        if (url.includes("raw.githubusercontent.com")) return url;
        if (url.includes("github.com") && url.includes("/blob/")) {
          return url
            .replace("https://github.com/", "https://raw.githubusercontent.com/")
            .replace("/blob/", "/");
        }
        return url;
      }

      function makeNoAgentsLabel(id) {
        return { id, kind: "label", name: "No agents yet" };
      }

      /**
       * COUNTING
       * - Uses explicit node.count when present (for grouped agents like Ã—27)
       * - Falls back to parsing "x27" or "Ã—27" from name/title
       * - Always traverses children (labels can contain agents in Combined view)
       */
      function agentMultiplier(node) {
        const explicit = Number(node.count);
        if (Number.isFinite(explicit) && explicit > 0) return explicit;

        const s = `${node.name || ""} ${node.title || ""}`;
        const m = s.match(/(?:\(|\b)(?:x|Ã—)\s*(\d+)\b\)?/i);
        const parsed = Number(m?.[1]);
        return Number.isFinite(parsed) && parsed > 0 ? parsed : 1;
      }

      function countKindsInNode(node, allowedKindsSet) {
        if (!node || typeof node !== "object") return 0;

        let total = 0;
        const kind = node.kind || "human";

        if (allowedKindsSet.has(kind)) {
          total += kind === "agent" ? agentMultiplier(node) : 1;
        }

        if (Array.isArray(node.children)) {
          for (const c of node.children) total += countKindsInNode(c, allowedKindsSet);
        }

        return total;
      }

      function countChartKinds(model, allowedKinds) {
        const kindsSet = new Set(allowedKinds);
        let total = 0;

        total += countKindsInNode(model.ceo, kindsSet);

        for (const dept of model.departments || []) {
          for (const m of dept.members || []) total += countKindsInNode(m, kindsSet);
        }

        return total;
      }

      // ==========================
      // AVATARS
      // ==========================
      const AV = {
        // Humans
        JB: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/JB.png"),
        Nauris: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Nauris.jpeg"),
        Monika: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Monika.png"),
        Chirag: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Chirag.png"),
        Mark: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Mark.jpeg"),
        Donatas: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Donatas.jpeg"),
        Edvinas: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Edvinas.jpeg"),
        Cosmin: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Cosmin.png"),
        Beatrice: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Beatrice.png"),
        Diana: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Diana.png"),
        Mert: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Mert.png"),
        Rudolfs: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Rudolfs.jpeg"),
        Suleman: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Suleman.png"),
        Justas: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Justas.jpeg"),
        James: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/James.png"),
        Cody: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Cody.png"),
        Magnus: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Magnus.jpeg"),

        // Agents
        MonikaSquad: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/MonikaAgent.png"),
        JamesAgents: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/James%20Agent.png"),
        DianaAgents: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Diana%20Agent.png"),
        DianaCapAgent: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/DianaCapAgent.png"),
        Onboarding: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/JBAgent.png"),
        PostMeeting: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/MertAgent.png"),
        QualAgent: toRawGitHub(
          "https://github.com/theclassegg/evergrowthOrg/blob/main/Coloured-Qualification-Clody.png"
        ),
        ResearchAgent: toRawGitHub(
          "https://github.com/theclassegg/evergrowthOrg/blob/main/Coloured-Research-Cody2.png"
        ),
        AccountPlanning: toRawGitHub(
          "https://github.com/theclassegg/evergrowthOrg/blob/main/Coloured-AccountPlanningCody.png"
        ),
        ContactFinder: toRawGitHub(
          "https://github.com/theclassegg/evergrowthOrg/blob/main/Coloured-Contactfinder-Cody.png"
        ),
        PlayAgent: toRawGitHub("https://github.com/theclassegg/evergrowthOrg/blob/main/Coloured-PlayAgent-Cody.png")
      };

      // ==========================
      // HUMANS
      // ==========================
      const HUMANS = {
        ceo: {
          id: "ceo",
          kind: "human",
          name: "JB DaguenÃ©",
          title: "CEO",
          avatarUrl: AV.JB,
          responsibilities: "Company strategy, exec decisions, prioritization, hiring.",
          bio: "Founder/CEO. Owns vision and overall execution."
        },
        departments: [
          {
            id: "dept-pe",
            name: "Product & Engineering",
            members: [
              {
                id: "nauris",
                kind: "human",
                name: "Nauris Dorbe",
                title: "CTO",
                avatarUrl: AV.Nauris,
                responsibilities: "Engineering leadership, technical strategy, architecture.",
                bio: "Leads Product & Engineering delivery and technical direction.",
                // No `layout: "column"` here so children render as ROW lanes (engineering lane + product lane)
                children: [
                  {
                    id: "donatas",
                    kind: "human",
                    name: "Donatas MaÅ¡lÄ—ktÄ—nas",
                    title: "Front-end Engineer",
                    avatarUrl: AV.Donatas,
                    responsibilities: "UI implementation, performance, component systems.",
                    bio: "Builds user-facing features and improves UX quality.",
                    layout: "column",
                    children: [
                      {
                        id: "marks",
                        kind: "human",
                        name: "Marks Leidemans",
                        title: "Senior Software Engineer",
                        avatarUrl: AV.Mark,
                        responsibilities: "Backend systems, reliability, core services.",
                        bio: "Builds and maintains key platform capabilities.",
                        layout: "column",
                        children: [
                          {
                            id: "cosmin",
                            kind: "human",
                            name: "Cosmin Romeo Tanase",
                            title: "Full-stack Engineer",
                            avatarUrl: AV.Cosmin,
                            responsibilities: "End-to-end feature delivery across stack.",
                            bio: "Ships features across frontend + backend.",
                            layout: "column",
                            children: [
                              {
                                id: "edvinas",
                                kind: "human",
                                name: "Edvinas Rabikis",
                                title: "Full Stack Engineer",
                                avatarUrl: AV.Edvinas,
                                responsibilities: "Product features, integrations, platform improvements.",
                                bio: "Delivers full-stack work across the product."
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  },
                  {
                    id: "monika",
                    kind: "human",
                    name: "Monika StaponkutÄ—",
                    title: "Head of Product",
                    avatarUrl: AV.Monika,
                    responsibilities: "Product strategy, roadmap, discovery, requirements.",
                    bio: "Owns the product direction and cross-functional alignment.",
                    layout: "column",
                    children: [
                      {
                        id: "chirag",
                        kind: "human",
                        name: "Chirag Patel",
                        title: "UX Design Lead",
                        avatarUrl: AV.Chirag,
                        responsibilities: "Design systems, user research, interaction design.",
                        bio: "Leads product design and user experience."
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            id: "dept-ops",
            name: "Operations",
            members: [
              {
                id: "beatrise",
                kind: "human",
                name: "Beatrise Pociute-DaguenÃ©",
                title: "Head of Business Operations",
                avatarUrl: AV.Beatrice,
                responsibilities: "Company ops, finance ops, systems/processes.",
                bio: "Keeps the business running smoothly.",
                layout: "column"
              }
            ]
          },
          {
            id: "dept-cs",
            name: "Customer Success",
            members: [
              {
                id: "diana",
                kind: "human",
                name: "Diana Heisler",
                title: "Head of CS",
                avatarUrl: AV.Diana,
                responsibilities: "Customer onboarding, renewals, support, outcomes.",
                bio: "Owns customer success and retention motions."
              },
              {
                id: "mert",
                kind: "human",
                name: "Mert Gencer",
                title: "Solutions Engineer",
                avatarUrl: AV.Mert,
                responsibilities: "Technical onboarding, implementations, support escalation.",
                bio: "Bridges product + customer technical needs.",
                layout: "column",
                children: [
                  {
                    id: "suleman",
                    kind: "human",
                    name: "Suleman Mahmud",
                    title: "GTM Ops",
                    avatarUrl: AV.Suleman,
                    responsibilities: "Rev ops support, systems, reporting, process.",
                    bio: "Keeps GTM operations tight and measurable."
                  },
                  {
                    id: "rudolfs",
                    kind: "human",
                    name: "Rudolfs Selga",
                    title: "GTM Ops",
                    avatarUrl: AV.Rudolfs,
                    responsibilities: "Ops support, tooling, data hygiene, process.",
                    bio: "Supports GTM systems and execution."
                  }
                ]
              }
            ]
          },
          {
            id: "dept-sales",
            name: "Sales",
            members: [
              {
                id: "justin",
                extraDeptIds: ["dept-cs"],
                kind: "human",
                name: "Justas RodzeviÄius",
                title: "Head of RevOps and Client Consulting",
                avatarUrl: AV.Justas,
                responsibilities: "RevOps strategy, client consulting delivery, enablement.",
                bio: "Owns RevOps + consulting engagements."
              },
              {
                id: "cody",
                kind: "human",
                name: "Cody Ayres",
                title: "Head of GTM",
                avatarUrl: AV.Cody,
                responsibilities: "GTM strategy, pipeline, sales execution.",
                bio: "Owns revenue outcomes and GTM performance."
              },
              {
                id: "magnus",
                kind: "human",
                name: "Magnus Thomsen",
                title: "Senior AE",
                avatarUrl: AV.Magnus,
                responsibilities: "Pipeline creation, deal execution, customer development.",
                bio: "Drives new business and expansions."
              }
            ]
          },
          {
            id: "dept-mktg",
            name: "Marketing",
            members: [
              {
                id: "james",
                kind: "human",
                name: "James Ince",
                title: "Head of Product Marketing",
                avatarUrl: AV.James,
                responsibilities: "Messaging, positioning, launches, enablement, competitive.",
                bio: "Owns product marketing strategy and execution."
              }
            ]
          }
        ]
      };

      // ==========================
      // AGENTS (flat lists)
      // ==========================
      const AGENTS = {
        ceo: makeNoAgentsLabel("a-ceo-none"),
        departments: [
          {
            id: "a-dept-pe",
            name: "Product & Engineering",
            members: [
              {
                id: "a-req-title",
                kind: "agent",
                trainerId: "monika",
                name: "New Request Titler",
                title: "Intake",
                avatarUrl: AV.MonikaSquad,
                responsibilities:
                  "Ingests the feature discussion thread from Slack and generates a succinct feature/update title.",
                bio: "Turns messy threads into crisp titles."
              },
              {
                id: "a-idea-score",
                kind: "agent",
                trainerId: "monika",
                name: "New Idea Scorer",
                title: "Scoring",
                avatarUrl: AV.MonikaSquad,
                responsibilities:
                  "Scores ideas (out of 5): ease of build, strategic alignment, revenue retention impact, new revenue impact.",
                bio: "Adds consistency to prioritization."
              },
              {
                id: "a-prd",
                kind: "agent",
                trainerId: "monika",
                name: "PRD Drafter",
                title: "Spec",
                avatarUrl: AV.MonikaSquad,
                responsibilities: "Drafts build requirements, JTBD, and user stories for new work.",
                bio: "Accelerates delivery-ready specs."
              },
              {
                id: "a-qa-assistant",
                kind: "agent",
                trainerId: "monika",
                name: "QA Assistant",
                title: "Quality",
                avatarUrl: AV.MonikaSquad,
                responsibilities:
                  "Infers impacted areas from product structure and drafts in-app QA tests to catch regressions.",
                bio: "Helps ensure releases donâ€™t break adjacent surfaces."
              }
            ]
          },
          { id: "a-dept-ops", name: "Operations", members: [makeNoAgentsLabel("a-ops-none")] },
          {
            id: "a-dept-cs",
            name: "Customer Success",
            members: [
              {
                id: "a-redflag",
                kind: "agent",
                trainerId: "diana",
                name: "Red Flag Agent",
                title: "Churn Risk",
                avatarUrl: AV.DianaAgents,
                responsibilities:
                  "Listens to customer calls and flags churn risks, adoption blockers, and issues for CS triage.",
                bio: "Surfaces risks early."
              },
              {
                id: "a-wins",
                kind: "agent",
                trainerId: "diana",
                name: "Wins Agent",
                title: "Celebrations",
                avatarUrl: AV.DianaAgents,
                responsibilities: "Listens for direct praise and wins for CS to celebrate internally.",
                bio: "Captures positivity and momentum."
              },
              {
                id: "a-meeting-followup",
                kind: "agent",
                trainerId: "diana",
                name: "Meeting-follow-up drafter",
                title: "Follow-up Copywriter",
                avatarUrl: AV.DianaCapAgent,
                responsibilities:
                  "Drafts customer-facing meeting follow-up emails & slack-DMs with recap, action items, owners, deadlines, and clear next steps.",
                bio: "Makes follow-ups fast, consistent, and thorough."
              },
              {
                id: "a-onboarding",
                kind: "agent",
                trainerId: "mert",
                name: "Onboarding Agent",
                title: "Tenant Setup",
                avatarUrl: AV.Onboarding,
                responsibilities:
                  "Works with GTM Ops to generate value props, ecosystems, verticals, qualification, research agents, and persona definitions for new tenants.",
                bio: "Speeds time-to-value."
              },
              {
                id: "a-postmeeting",
                kind: "agent",
                trainerId: "mert",
                name: "Post-Meeting Assistant",
                title: "Notes & Tasks",
                avatarUrl: AV.PostMeeting,
                responsibilities: "Creates meeting summaries and assigns to-do tasks to Mert.",
                bio: "Cuts follow-up time."
              },
              {
                id: "a-triage",
                kind: "agent",
                trainerId: "mert",
                name: "Customer Request Triager",
                title: "Services Intake",
                avatarUrl: AV.DianaAgents,
                responsibilities:
                  "Estimates effort for professional services requests and assigns to the relevant GTM Ops consultant.",
                bio: "Keeps services work organized."
              }
            ]
          },
          {
            id: "a-dept-sales",
            name: "Sales",
            members: [
              {
                id: "a-qual",
                kind: "agent",
                trainerId: "cody",
                name: "Prospect Qualification Agents Ã—9",
                title: "Fit Validation",
                count: 9,
                avatarUrl: AV.QualAgent,
                responsibilities: "Research new prospects to validate fit before outreach.",
                bio: "Filters to high-likelihood accounts."
              },
              {
                id: "a-research",
                kind: "agent",
                trainerId: "cody",
                name: "Research Agents Ã—27",
                count: 27,
                title: "Buying Signals",
                avatarUrl: AV.ResearchAgent,
                responsibilities: "Find buying intent signals to improve outreach and sales strategy.",
                bio: "Keeps outreach sharp and timely."
              },
              {
                id: "a-account-plan",
                kind: "agent",
                trainerId: "cody",
                name: "Account Planning Agent",
                title: "Strategy",
                avatarUrl: AV.AccountPlanning,
                responsibilities: "Distills research + value prop to brief Cody & Magnus on the best approach.",
                bio: "Accelerates account ramp-up."
              },
              {
                id: "a-contact-finder",
                kind: "agent",
                trainerId: "cody",
                name: "Contact Finder",
                title: "Buyer Discovery",
                avatarUrl: AV.ContactFinder,
                responsibilities: "Finds ideal buyers at qualified prospects, including email and phone numbers.",
                bio: "Cuts list-building time."
              },
              {
                id: "a-play",
                kind: "agent",
                trainerId: "cody",
                name: "Play Agents Ã—5",
                count: 5,
                title: "Outreach Drafting",
                avatarUrl: AV.PlayAgent,
                responsibilities:
                  "Drafts emails, talk tracks, and LinkedIn DMs weaving buying signals with Evergrowth messaging.",
                bio: "Creates ready-to-send plays."
              }
            ]
          },
          {
            id: "a-dept-mktg",
            name: "Marketing",
            members: [
              {
                id: "a-release",
                kind: "agent",
                trainerId: "james",
                name: "New Release Planner",
                title: "Launch Ops",
                avatarUrl: AV.JamesAgents,
                responsibilities:
                  "Ingests release tasks and breaks out PMM steps based on tier (video, KB, socials, enablement).",
                bio: "Turns features into launch plans."
              },
              {
                id: "a-case-study",
                kind: "agent",
                trainerId: "james",
                name: "Case Study Scout",
                title: "Customer Proof",
                avatarUrl: AV.JamesAgents,
                responsibilities:
                  "Listens to calls for quotes indicating good fits for customer interview & case study.",
                bio: "Identifies strong stories."
              },
              {
                id: "a-quote-bank",
                kind: "agent",
                trainerId: "james",
                name: "Quote Bank",
                title: "Praise Capture",
                avatarUrl: AV.JamesAgents,
                responsibilities: "Logs explicit praise + realized benefits into a Google Sheet quote bank.",
                bio: "Builds a proof library."
              },
              {
                id: "a-comp-quotes",
                kind: "agent",
                trainerId: "james",
                name: "Competitor Quote Bank",
                title: "Competitive Intel",
                avatarUrl: AV.JamesAgents,
                responsibilities:
                  "Logs explicit competitor frustrations and denigrations into a separate quote bank.",
                bio: "Strengthens competitive messaging."
              }
            ]
          }
        ]
      };

      // ==========================
      // Combined view build
      // ==========================
      const COMBINED = deepClone(HUMANS);
      injectAgentsIntoCombined(COMBINED, AGENTS);

      // ==========================
      // Mounts + state
      // ==========================
      const ceoMount = document.getElementById("ceoMount");
      const deptMount = document.getElementById("deptMount");
      const wires = document.getElementById("wires");
      const chart = document.getElementById("chart");
      const board = document.getElementById("board");
      const tooltip = document.getElementById("tooltip");

      const btnHumans = document.getElementById("btn-humans");
      const btnAgents = document.getElementById("btn-agents");
      const btnCombined = document.getElementById("btn-combined");

      const themeToggle = document.getElementById("themeToggle");

      const VIEWS = { humans: HUMANS, agents: AGENTS, combined: COMBINED };
      let currentView = "humans";
      let raf = null;

      // Default theme: LIGHT
      setTheme("light");

      // Set button labels with counts (and no â€œâ€”â€)
      updateViewButtonLabels();

      btnHumans.addEventListener("click", () => setView("humans"));
      btnAgents.addEventListener("click", () => setView("agents"));
      btnCombined.addEventListener("click", () => setView("combined"));

      themeToggle.addEventListener("click", () => {
        const isDark = document.documentElement.getAttribute("data-theme") === "dark";
        setTheme(isDark ? "light" : "dark");
      });

      function setTheme(theme) {
        if (theme === "dark") {
          document.documentElement.setAttribute("data-theme", "dark");
          themeToggle.textContent = "Light mode";
          themeToggle.setAttribute("aria-pressed", "true");
        } else {
          document.documentElement.removeAttribute("data-theme");
          themeToggle.textContent = "Dark mode";
          themeToggle.setAttribute("aria-pressed", "false");
        }

        requestAnimationFrame(() => {
          sizeSvgToContent();
          drawWires();
        });
      }

      function updateViewButtonLabels() {
        const humansCount = countChartKinds(HUMANS, ["human"]);
        const agentsCount = countChartKinds(AGENTS, ["agent"]);
        const combinedCount = countChartKinds(COMBINED, ["human", "agent"]);

        btnHumans.textContent = `1 Humans only (${humansCount})`;
        btnAgents.textContent = `2 Agents only (${agentsCount})`;
        btnCombined.textContent = `3 Combined (${combinedCount})`;
      }

      function setView(view) {
        currentView = view;
        btnHumans.setAttribute("aria-pressed", view === "humans");
        btnAgents.setAttribute("aria-pressed", view === "agents");
        btnCombined.setAttribute("aria-pressed", view === "combined");
        render(VIEWS[view]);
      }

      render(VIEWS[currentView]);

      window.addEventListener("resize", scheduleWires);
      board.addEventListener("scroll", scheduleWires, { passive: true });

      function scheduleWires() {
        if (raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(drawWires);
      }

      // ==========================
      // Render
      // ==========================
      function render(model) {
        ceoMount.innerHTML = "";
        deptMount.innerHTML = "";
        wires.innerHTML = "";

        const edges = [];

        ceoMount.appendChild(renderNode(model.ceo));

        for (const dept of model.departments) {
          const deptEl = document.createElement("div");
          deptEl.className = "dept";

          const humanDeptId = dept.id.startsWith("a-") ? nameToHumanDeptId(dept.name) : dept.id;

          deptEl.dataset.dept = humanDeptId || dept.id;

          const pill = document.createElement("div");
          pill.className = "dept-pill";
          pill.textContent = dept.name;
          pill.dataset.nodeId = dept.id;
          deptEl.appendChild(pill);

          edges.push([model.ceo.id, dept.id]);

          const members = document.createElement("div");
          members.className = "children";

          for (const m of dept.members || []) {
            members.appendChild(renderSubtree(m, edges));
            edges.push([dept.id, m.id]);

            if (Array.isArray(m.extraDeptIds)) {
              for (const extraDeptId of m.extraDeptIds) edges.push([extraDeptId, m.id]);
            }
          }

          deptEl.appendChild(members);
          deptMount.appendChild(deptEl);
        }

        bindTooltips();
        chart.__edges = edges;

        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            sizeSvgToContent();
            drawWires();
          });
        });
      }

      function nameToHumanDeptId(name) {
        const map = {
          "Product & Engineering": "dept-pe",
          "Operations": "dept-ops",
          "Customer Success": "dept-cs",
          "Sales": "dept-sales",
          "Marketing": "dept-mktg"
        };
        return map[name] || null;
      }

      function renderSubtree(node, edges) {
        const wrap = document.createElement("div");
        wrap.className = "node-wrap";

        wrap.appendChild(renderNode(node));

        if (node.children && node.children.length) {
          const kids = document.createElement("div");
          kids.className = "children" + (node.layout === "column" ? " column" : "");
          for (const child of node.children) {
            kids.appendChild(renderSubtree(child, edges));
            edges.push([node.id, child.id]);
          }
          wrap.appendChild(kids);
        }

        return wrap;
      }

      function renderNode(node) {
        const kind = node.kind || "human";

        if (kind === "label") {
          const label = document.createElement("div");
          label.className = "node label";
          label.dataset.nodeId = node.id;
          label.textContent = node.name || "";
          return label;
        }

        const card = document.createElement("div");
        card.className = "node" + (kind === "agent" ? " agent" : "");
        card.dataset.nodeId = node.id;

        card.dataset.name = node.name || "";
        card.dataset.title = node.title || "";
        card.dataset.responsibilities = node.responsibilities || "";
        card.dataset.bio = node.bio || "";

        const row = document.createElement("div");
        row.className = "row";

        const avatar = document.createElement("div");
        avatar.className = "avatar" + (kind === "agent" ? " agent" : "");

        if (node.avatarUrl) {
          const img = document.createElement("img");
          img.src = node.avatarUrl;
          img.alt = node.name || "Avatar";
          img.loading = "lazy";
          avatar.appendChild(img);
        } else {
          const ph = document.createElement("div");
          ph.className = "ph";
          ph.textContent = kind === "agent" ? "ðŸ¤–" : initials(node.name || "");
          avatar.appendChild(ph);
        }

        const text = document.createElement("div");
        text.className = "text";

        const name = document.createElement("div");
        name.className = "name";
        name.textContent = node.name || "(Unnamed)";

        const title = document.createElement("div");
        title.className = "title";
        title.textContent = node.title || "";

        text.appendChild(name);
        if (node.title) text.appendChild(title);

        row.appendChild(avatar);
        row.appendChild(text);

        const meta = document.createElement("div");
        meta.className = "meta";

        const badge = document.createElement("span");
        badge.className = "badge" + (kind === "agent" ? " agent" : "");
        badge.innerHTML = `<span class="mini"></span><span>${kind === "agent" ? "Agent" : "Human"}</span>`;

        meta.appendChild(badge);

        card.appendChild(row);
        card.appendChild(meta);

        return card;
      }

      // ==========================
      // Wires
      // ==========================
      function sizeSvgToContent() {
        const w = chart.scrollWidth;
        const h = chart.scrollHeight;
        wires.setAttribute("width", w);
        wires.setAttribute("height", h);
        wires.setAttribute("viewBox", `0 0 ${w} ${h}`);
      }

      function drawWires() {
        if (!chart.__edges) return;

        sizeSvgToContent();
        wires.innerHTML = "";

        const chartRect = chart.getBoundingClientRect();
        const idToEl = {};
        chart.querySelectorAll("[data-node-id]").forEach((el) => {
          idToEl[el.dataset.nodeId] = el;
        });

        const cssR = getComputedStyle(document.documentElement)
          .getPropertyValue("--wireRadius")
          .trim();
        const baseR = Number(cssR) || 44;

        for (const [fromId, toId] of chart.__edges) {
          const a = idToEl[fromId];
          const b = idToEl[toId];
          if (!a || !b) continue;

          const ar = a.getBoundingClientRect();
          const br = b.getBoundingClientRect();

          const x1 = (ar.left + ar.right) / 2 - chartRect.left;
          const y1 = ar.bottom - chartRect.top;

          const x2 = (br.left + br.right) / 2 - chartRect.left;

          const isDeptPill = b.classList && b.classList.contains("dept-pill");
          const isNodeCard = b.classList && b.classList.contains("node") && !b.classList.contains("label");

          const endPad = isDeptPill ? 18 : isNodeCard ? 14 : 0;
          const y2 = br.top - chartRect.top - endPad;

          const preferredBus = y1 + 28;
          const avoidTarget = y2 - 36;
          let midY = Math.min(preferredBus, avoidTarget);

          const hh = Math.abs(x2 - x1);
          const v1 = Math.max(0, midY - y1);
          const v2 = Math.max(0, y2 - midY);

          const rr = Math.max(0, Math.min(baseR, hh / 2, v1 / 2, v2 / 2));
          const minMid = y1 + rr + 4;
          const maxMid = y2 - rr - 4;
          midY = Math.max(minMid, Math.min(maxMid, midY));

          let d;

          if (Math.abs(x2 - x1) < 6) {
            d = `M ${x1} ${y1} V ${y2}`;
          } else {
            const dir = x2 > x1 ? 1 : -1;
            d = `
              M ${x1} ${y1}
              V ${midY - rr}
              Q ${x1} ${midY} ${x1 + rr * dir} ${midY}
              H ${x2 - rr * dir}
              Q ${x2} ${midY} ${x2} ${midY + rr}
              V ${y2}
            `;
          }

          const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
          path.setAttribute("d", d);
          wires.appendChild(path);

          if (endPad > 0) {
            const drop = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const yTop = br.top - chartRect.top - endPad;
            const yEdge = br.top - chartRect.top;
            drop.setAttribute("d", `M ${x2} ${yTop} V ${yEdge}`);
            wires.appendChild(drop);
          }
        }
      }

      // ==========================
      // Tooltips
      // ==========================
      function bindTooltips() {
        chart.querySelectorAll(".node:not(.label)").forEach((el) => {
          el.addEventListener("mouseenter", (e) => showTooltip(e.currentTarget, e));
          el.addEventListener("mousemove", (e) => moveTooltip(e));
          el.addEventListener("mouseleave", hideTooltip);
        });
      }

      function showTooltip(el, e) {
        const name = el.dataset.name || "";
        const title = el.dataset.title || "";
        const responsibilities = el.dataset.responsibilities || "";
        const bio = el.dataset.bio || "";

        if (!responsibilities && !bio) return;

        tooltip.innerHTML = `
          <h3>${escapeHtml(name)}</h3>
          ${title ? `<div class="tt-title">${escapeHtml(title)}</div>` : ""}
          ${
            responsibilities
              ? `<div class="tt-label">Responsibilities</div><p class="tt-body">${escapeHtml(
                  responsibilities
                )}</p>`
              : ""
          }
          ${
            bio
              ? `<div class="tt-label">Bio</div><p class="tt-body">${escapeHtml(bio)}</p>`
              : ""
          }
        `;

        tooltip.classList.add("show");
        tooltip.setAttribute("aria-hidden", "false");
        moveTooltip(e);
      }

      function moveTooltip(e) {
        const pad = 14;
        const rect = tooltip.getBoundingClientRect();
        let x = e.clientX + 14;
        let y = e.clientY + 14;

        if (x + rect.width + pad > window.innerWidth) x = e.clientX - rect.width - 14;
        if (y + rect.height + pad > window.innerHeight) y = e.clientY - rect.height - 14;

        tooltip.style.left = x + "px";
        tooltip.style.top = y + "px";
      }

      function hideTooltip() {
        tooltip.classList.remove("show");
        tooltip.setAttribute("aria-hidden", "true");
      }

      // ==========================
      // Combined injection (agents attach under trainer humans)
      // ==========================
      function injectAgentsIntoCombined(humans, agents) {
        const index = new Map();

        index.set(humans.ceo.id, humans.ceo);
        for (const dept of humans.departments) {
          for (const m of dept.members || []) walk(m);
        }

        function walk(node) {
          index.set(node.id, node);
          if (node.children) node.children.forEach(walk);
        }

        for (const aDept of agents.departments || []) {
          for (const aNode of aDept.members || []) {
            const trainerId = aNode.trainerId || null;
            const fallbackLead = (humans.departments.find((d) => d.name === aDept.name)?.members || [])[0];
            const targetId =
              trainerId && index.has(trainerId)
                ? trainerId
                : fallbackLead
                  ? fallbackLead.id
                  : null;

            if (!targetId || !index.has(targetId)) continue;

            const target = index.get(targetId);

            if (aNode.kind === "label" && (aNode.name || "").toLowerCase().includes("no agents")) {
              target.children = target.children || [];
              target.children.push(aNode);
              target.layout = target.layout || "column";
              continue;
            }

            target.children = target.children || [];
            let label = target.children.find((c) => c.kind === "label" && c.__isAgentsBucket);
            if (!label) {
              label = {
                id: `${target.id}__agents_bucket`,
                kind: "label",
                name: "Agents",
                layout: "row",
                children: [],
                __isAgentsBucket: true
              };
              target.children.push(label);
            }

            label.children = label.children || [];
            label.children.push(aNode);

            target.layout = target.layout || "column";
          }
        }
      }
    </script>
  </body>
</html>
